#### 安全检查：

> 按照需要进行过滤

通过一个安全检查的过程，可以**梳理未知数据**，使其**变得可信任**。被划分出来的具有不同信任级别的区域，称为**信任域**，划分两个不同信任域之间的边界，我们称为**信任边界**。

> 数据从高等级的信任域流向低等级的信任域不需要安全检查。
>
> 数据从低等级的信任域流向高等级的信任域需要安全检查。



### 安全的三要素

**机密性**：保护数据内容不能泄露。

> 一般用加密的方法来实现

**完整性**：保护数据内容是完整、没有被褚篡改的。

> 一般采用数字签名的方法实现

**可用性**：保护资源”随需而得“。

> 将所有可用资源全部占用，在安全领域成为**拒绝服务攻击**，简称**DoS攻击**（`Denial of Service`）



### 安全评估

**资产等级划分** —> **威胁分析 —> 风险分析 —> 确认解决方案**

**资产等级划分**：

> 对保护的目标进行信任域和信任边界的划分。
>
> 一般是从网络逻辑上进行划分，划分数据库服务器，Web服务器以及普通的Internet。

**威胁分析**：

威胁分析就是把所有的威胁找出来。

> 在安全领域里，将可能造成危害的来源称为**威胁**（Threat），而将可能会出现的损失称为**风险**（Risk）。

找出威胁的方式：

1. 头脑风暴法：
2. 威胁建模法（STRIDE模型）[微软]：

|                威胁                |       定义       | 对应的安全属性 |
| :--------------------------------: | :--------------: | :------------: |
|          Spoofing（伪装）          |   冒充他人身份   |      认证      |
|         Tampering（篡改）          |  修改数据和代码  |     完整性     |
|        Repudiation（抵赖）         |  否认做过的事情  |   不可抵赖性   |
| Information Disclosure（信息泄露） |   机密信息泄露   |     机密性     |
|   Denial of Service（拒绝服务）    |     拒绝服务     |     可用性     |
| Elevation of Privilege（提升效果） | 未经授权获得许可 |      授权      |

**风险分析**：

Risk （风险）= Probability（概率） * Damage Potential （破坏潜力）    <!--风险分析构成因素-->

风险的衡量（DREAD模型）[微软]：

| 等级                         | 高（3）                                        | 中（2）                                    | 低（1）                |
| ---------------------------- | ---------------------------------------------- | ------------------------------------------ | ---------------------- |
| Damage Potential（潜在损害） | 获取完全验证权限：执行管路员操作；非法上传文件 | 泄露敏感信息                               | 泄露其他信息           |
| Reproducibility（可重现）    | 攻击者可以随意再次攻击                         | 攻击者可以重复攻击，但有时间限制           | 攻击者很难重复攻击过程 |
| Exploitability（可利用）     | 初学者在短期内能掌握攻击方法                   | 熟练地攻击者才能够完成攻击                 | 漏洞利用条件非常苛刻   |
| Affected users（影响用户）   | 所有用户，默认配置，关键用户                   | 部分用户，并非默认配置                     | 极少数用户，匿名用户   |
| Discoverability（可发现）    | 漏洞很显眼，攻击条件很容易获得                 | 在私有区域，部分人能看到，需要深入挖掘漏洞 | 发现该漏洞极其困难     |

> 利用高中低的权重，可以计算威胁的风险值，并根据风险的高低定义，划分高中低危风险

**设计安全方案**：

解决方案需要有**针对性**，针对性取决于资产阶级划分、威胁分析、风险分析的结合。

一个优秀的安全方案需要具备的特点：

- 能够有效地解决问题
- 用户体验性好
- 高性能
- 低耦合
- 易于扩展和升级



### 实战方法

#### Secure By Default原则：

> 白名单、黑名单思想

**白名单黑名单规则**：

- 尽量使用白名单而尽量减少使用黑名单

> 原因：加入白名单的**一定**是好的，未被加入黑名单却**不一定**是好的

**最小权限原则**：

系统只授予主体必要的权限，而不要过度授权，这样可以有效地减少系统、网络、应用、数据库出错的机会。

> 实际操作中，普通用户并不会意思授予权限过高。可以设置一些反问句，比如：**您确定要这样做吗？**来解决问题。

#### 纵深防御原则（Defense inDepth）

- 在**不同层面**、**不同方面**实施安全方案，避免出现疏漏，不同安全方案相互配合构成一个整体。

> 在设计安全方案时，尽可能考虑到web应用安全，OS系统安全，数据库安全，网络环境安全等不同层面。共同组成防御体系。

- 解决根本问题的地方实施针对性的安全方案。

> 在对用户输入的html进行过滤时，要先进行语法树的分析，而不是粗暴的进行< 等过滤，以免造成用户本意想表达如1<2的意思

#### 代码与数据分离原则

> 广泛用于各种由“注入”而引发的安全问题场景

#### 不可预测性原则

数据与代码分离是从漏洞的成因上做出防御，而不可预测性原则则是从克服攻击方法的角度看待问题。这是一种即使无法修复代码，但是让攻击变得无效的成功的防御。

- 让程序的栈基址变得随机化，使攻击程序无法准确猜测到内存地址，而大大的提高攻击的门槛
- 在一些应用系统中，使用随机的id
- 使用一些加密算法
-  ...